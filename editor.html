<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" sizes="192x192" href="https://1nrp.github.io/1/Images/N-Logo1.png">
  <title>Nihar's JS Notebook</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #0d203040;
      padding: 0;
    }
    .toolbar {
      padding: 4px;
      background-color: #00200020;
      border-bottom: 2px solid #34a054;
    }
    .toolbar input {
      font-size: 16px;
      border: 2px solid #34a054;
      background-color: #00400040;
      border-radius: 5px;
      padding: 5px;
    }
    .toolbar button {
      padding: 2px 6px;
      font-size: 14px;
      font-weight: 600;
      border-radius: 5px;
      background-color: #00400040;
      border: 2px solid #34a054;
    }
    .toolbar button:hover {
      background-color: #23974060;
    }
    .cell {
      border: 1px solid #ccc;
      margin: 2px;
      padding: 2px;
      width: 97.2vw;
      height: auto;
      border-radius: 5px;
    }
    .code-cell, .text-cell {
      position: relative;
      border: 2px solid #2e633540;
      border-radius: 4px;
      background-color: #397ba720;
    }
    .cell-buttons {
      position: absolute;
      top: 2px;
      right: 4px;
      display: flex;
      gap: 25px;
      opacity: 0.1;
      margin: 4px 0px;
      z-index: 100;
    }
    .cell-buttons:hover {
     opacity: 1;
    }
    .cell-buttons button {
      background-color: #4c8fb6b0;
      border: 2px solid #2e6335;
      padding: 6px;
      border-radius: 4px;
    }
    .cell-buttons button:hover {
      background-color: #444;
    }
    .output {
      overflow-y: visible;
      width: 98%;
    }
    .logDiv {
      font-family: 'Times New Roman', Times, sans-serif;
      border-top: 1px solid #33558880;
      padding: 4px;
      width: 100%;
      margin: 4px 0px;
      background-color: #02103020;
    }
    .errorDiv {
      color: #ddd;
      border: 1px solid #d00;
      padding: 4px;
      margin: 4px 0px;
      background-color: #40000040;
    }
    .minimized {
      max-height: 40px;
    }
    .markdown-render {
      padding: 10px;
      background: #fff;
      border: 1px dashed #ccc;
      border-radius: 5px;
    }
    
.syntax-editor {
  font-family: monospace;
  white-space: pre-wrap;
  word-wrap: break-word;
  line-height: 1.5;
  padding: 10px;
  border: 1px solid #ccc;
  min-height: 200px;
  background-color: #f5f5f5;
}

.highlight-keyword {
  color: blue;
  font-weight: bold;
}

.highlight-variable {
  color: green;
}

.highlight-number {
  color: red;
}

.highlight-function {
  color: purple;
}

.highlight-comment {
  color: gray;
}

.highlight-string {
  color: brown;
}

.highlight-bracket {
  color: orange;
}

  </style>
</head>
<body>
  <div class="toolbar">
    <input style="display:none; margin:0px 0px 4px 0px;" id="notebook-title" placeholder="Untitled Notebook" value="Untitled Notebook">
    <div>
      <button id="add-code" style="padding: 3px 6px">+ CODE</button>
      <button id="add-text" style="padding: 3px 6px">+ TEXT</button>
      <button id="download-notebook">▼ LOAD</button>
      <input id="upload-notebook" type="file" style="display: none;">
      <button id="upload-trigger">▲ LOAD</button>
      <button style="margin:0px 0px 0px 10px" id="move-down">▼</button>
      <button id="move-up" onclick="">▲</button>
    </div>
  </div>
  <div id="notebook"></div>
  <div id="editor" contenteditable="true" class="syntax-editor"></div>

  <script>
  
const keywords = ["var", "let", "const", "function", "return", "if", "else", "for", "while", "class", "this", "new", "try", "catch", "break", "continue", "typeof", "instanceof"];
const symbols = ["(", ")", "{", "}", "[", "]", '"', "'", "//"];

document.getElementById("editor").addEventListener("input", function(event) {
  highlightSyntax(event.target);
});

function highlightSyntax(div) {
  const content = div.textContent;
  
  // Replace content with highlights
  let highlightedContent = content;

  // Highlight numbers
  highlightedContent = highlightedContent.replace(/(\b\d+(\.\d+)?\b)/g, `<span class="highlight-number">$1</span>`);

  // Highlight strings (in quotes)
  highlightedContent = highlightedContent.replace(/(['"`])(.*?)(\1)/g, `<span class="highlight-string">$&</span>`);

  // Highlight comments (after //)
  highlightedContent = highlightedContent.replace(/(\/\/.*?)(\n|$)/g, `<span class="highlight-comment">$1</span>`);

  // Highlight keywords
  highlightedContent = highlightedContent.replace(new RegExp(`\\b(${keywords.join("|")})\\b`, 'g'), `<span class="highlight-keyword">$1</span>`);

  // Highlight functions (identifiers followed by ())
  highlightedContent = highlightedContent.replace(/\b(\w+)\(\)/g, `<span class="highlight-function">$&</span>`);

  // Highlight variables (check after var, let, const)
  highlightedContent = highlightedContent.replace(/\b(var|let|const)\s+(\w+)\b/g, `<span class="highlight-variable">$2</span>`);

  // Highlight brackets and move the cursor inside them
  highlightedContent = highlightedContent.replace(/(\{|\}|\[|\]|\(|\))/g, `<span class="highlight-bracket">$1</span>`);

  // Apply the highlighted content
  div.innerHTML = highlightedContent;

  // Move the cursor to the middle of the matching bracket or quote
  placeCursorAtMatchingPair(div);
}

function placeCursorAtMatchingPair(div) {
  const range = window.getSelection().getRangeAt(0);
  const cursorPosition = range.startOffset;
  const content = div.innerHTML;

  const openBrackets = ['{', '[', '(', '"', "'"];
  const closeBrackets = ['}', ']', ')', '"', "'"];
  const matchingPairs = {
    '{': '}',
    '[': ']',
    '(': ')',
    '"': '"',
    "'": "'"
  };

  let currentChar = content.charAt(cursorPosition);

  // Check for matching pair when inside brackets or quotes
  if (openBrackets.includes(currentChar)) {
    let closingChar = matchingPairs[currentChar];
    let closingPos = content.indexOf(closingChar, cursorPosition);
    if (closingPos > cursorPosition) {
      setCursorAt(content, closingPos);
    }
  }
}

function setCursorAt(content, position) {
  const range = document.createRange();
  const selection = window.getSelection();
  range.setStart(content, position);
  range.setEnd(content, position);
  selection.removeAllRanges();
  selection.addRange(range);
}

    // Editor settings.
    let cellCounter = 0;
    const notebook = document.getElementById('notebook');
    function createCodeCell() {
      const cellId = `cell-${++cellCounter}`;
      const cell = document.createElement('div');
      cell.classList.add('cell', 'code-cell');
      cell.id = cellId;
      cell.innerHTML = `
        <div class="cell-buttons">
          <button onclick="runCode('${cellId}')">⚙️</button>
          <button onclick="minimizeCell('${cellId}')">▶️</button>
          <button onclick="deleteCell('${cellId}')">❌</button>
        </div>
        <textarea class="code-editor"></textarea>
        <div class="output"></div>
      `;
      notebook.appendChild(cell);
    }

    function createTextCell() {
      const cellId = `cell-${++cellCounter}`;
      const cell = document.createElement('div');
      cell.classList.add('cell', 'text-cell');
      cell.id = cellId;
      cell.innerHTML = `
        <div class="cell-buttons">
          <button onclick="toggleMarkdown('${cellId}')">Toggle Markdown</button>
          <button onclick="minimizeCell('${cellId}')">&#9660;</button>
          <button onclick="deleteCell('${cellId}')">Delete</button>
        </div>
        <textarea class="markdown-editor"></textarea>
        <div class="markdown-render minimized"></div>
      `;
      notebook.appendChild(cell);
    }

    function runCode(cellId) {
      const cell = document.getElementById(cellId);
      const output = cell.querySelector('.output');
      output.innerHTML = '';

      const cleanup = redirectConsole(output);
      try {
        const code = cell.editor.getValue();
        new Function(code)();
      } catch (err) {
        console.error(err.message);
      }
      cleanup();
    }
    async function runCode(cellId) {
      const cell = document.getElementById(cellId);
      const output = cell.querySelector('.output');
      output.innerHTML = '';

      const cleanup = redirectConsole(output);
      try {
        const code = cell.editor.getValue();
        await new Function(`return (async () => { ${code} })()`)();
      } catch (err) {
        console.error(err.message);
      }
      cleanup();
    }

    function redirectConsole(output) {
      const originalLog = console.log;
      const originalError = console.error;

      console.log = (...args) => {
        const msg = document.createElement('div');
        msg.className = 'logDiv';
        msg.textContent = '» ' + args.join('');
        output.appendChild(msg);
      };

      console.error = (...args) => {
        const msg = document.createElement('div');
        msg.className = 'errorDiv';
        msg.textContent = '» ' + args.join('');
        output.appendChild(msg);
      };

      return () => {
        console.log = originalLog;
        console.error = originalError;
      };
    }

    function toggleMarkdown(cellId) {
      const cell = document.getElementById(cellId);
      const editor = cell.querySelector('.markdown-editor');
      const render = cell.querySelector('.markdown-render');

      if (render.classList.contains('minimized')) {
        render.innerHTML = marked(editor.value);
        editor.classList.add('minimized');
        render.classList.remove('minimized');
      } else {
        editor.classList.remove('minimized');
        render.classList.add('minimized');
      }
    }

    function minimizeCell(cellId) {
      const cell = document.getElementById(cellId);
      const codeMirrorCells = document.getElementsByClassName('CodeMirror');
      for (let i = 0; i < codeMirrorCells.length; i++) {
          codeMirrorCells[i].classList.toggle('minimized');
      }
     cell.classList.toggle('minimized');
    }

    function deleteCell(cellId) {
      const cell = document.getElementById(cellId);
      cell.remove();
    }

    function downloadNotebook() {
      const title = document.getElementById('notebook-title').value;
      const content = { title, cells: [] };

      notebook.querySelectorAll('.cell').forEach(cell => {
        if (cell.classList.contains('code-cell')) {
          content.cells.push({ type: 'code', content: cell.editor.getValue() });
        } else if (cell.classList.contains('text-cell')) {
          const markdown = cell.querySelector('.markdown-editor').value;
          content.cells.push({ type: 'text', content: markdown });
        }
      });

      const blob = new Blob([JSON.stringify(content, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `JSNB-${title || 'Notebook'}.json`;
      link.click();
    }

    function uploadNotebook(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = e => {
        const content = JSON.parse(e.target.result);
        document.getElementById('notebook-title').value = content.title || 'Untitled Notebook';

        notebook.innerHTML = '';
        content.cells.forEach(cell => {
          if (cell.type === 'code') {
            createCodeCell();
            notebook.lastChild.editor.setValue(cell.content);
          } else if (cell.type === 'text') {
            createTextCell();
            notebook.lastChild.querySelector('.markdown-editor').value = cell.content;
          }
        });
      };

      reader.readAsText(file);
    }

    document.getElementById('add-code').addEventListener('click', createCodeCell);
    document.getElementById('add-text').addEventListener('click', createTextCell);
    document.getElementById('download-notebook').addEventListener('click', downloadNotebook);
    document.getElementById('upload-trigger').addEventListener('click', () => document.getElementById('upload-notebook').click());
    document.getElementById('upload-notebook').addEventListener('change', uploadNotebook);
  </script>
</body>
</html>
-->
<div id="editor" contenteditable="true"></div>
<div id="editor2" contenteditable="true"></div>
<style>
  .highlight-number { color: blue; }
  .highlight-string { color: green; }
  .highlight-comment { color: gray; font-style: italic; }
  .highlight-keyword { color: purple; font-weight: bold; }
  .highlight-function { color: orange; }
  .highlight-variable { color: brown; }
  .highlight-bracket { color: red; }
  #editor {
    white-space: pre; /* Preserve formatting for code */
    font-family: monospace; /* Make it look like a code editor */
    position: relative;
    z-index: 1;
    caret-color: black; /* Keep cursor visible */
  }
  #highlight {
    position: absolute;
    z-index: 0;
    pointer-events: none;
    color: transparent;
    white-space: pre;
    font-family: monospace;
    overflow: hidden;
    word-wrap: break-word;
  }
</style>
<div id="highlight"></div>
<script>
  const keywords = ["var", "let", "const", "function", "return", "if", "else", "for", "while", "class", "this", "new", "try", "catch", "break", "continue", "typeof", "instanceof"];

  const editor = document.getElementById("editor");
  const highlightDiv = document.getElementById("highlight");

  editor.addEventListener("input", () => {
    updateHighlight();
  });

  function updateHighlight() {
    const content = editor.textContent;

    // Escape special HTML characters
    const escapedContent = content.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

    // Highlight numbers
    let highlightedContent = escapedContent.replace(/(\b\d+(\.\d+)?\b)/g, `<span class="highlight-number">$1</span>`);

    // Highlight strings
    highlightedContent = highlightedContent.replace(/(['"`])(.*?)(\1)/g, `<span class="highlight-string">$&</span>`);

    // Highlight comments
    highlightedContent = highlightedContent.replace(/(\/\/.*?)(\n|$)/g, `<span class="highlight-comment">$1</span>`);

    // Highlight keywords
    highlightedContent = highlightedContent.replace(new RegExp(`\\b(${keywords.join("|")})\\b`, "g"), `<span class="highlight-keyword">$1</span>`);

    // Highlight functions
    highlightedContent = highlightedContent.replace(/\b(\w+)\(\)/g, `<span class="highlight-function">$&</span>`);

    // Highlight variables
    highlightedContent = highlightedContent.replace(/\b(var|let|const)\s+(\w+)\b/g, `<span class="highlight-variable">$2</span>`);

    // Highlight brackets
    highlightedContent = highlightedContent.replace(/(\{|\}|\[|\]|\(|\))/g, `<span class="highlight-bracket">$1</span>`);

    // Update the highlight display
    highlightDiv.innerHTML = highlightedContent;
  }

  // Sync scrolling between the editor and highlight div
  editor.addEventListener("scroll", () => {
    highlightDiv.scrollTop = editor.scrollTop;
    highlightDiv.scrollLeft = editor.scrollLeft;
  });

  // Initialize
  updateHighlight();



const keywords = ["var", "let", "const", "function", "return", "if", "else", "for", "while", "class", "this", "new", "try", "catch", "break", "continue", "typeof", "instanceof"];
const symbols = ["(", ")", "{", "}", "[", "]", '"', "'", "//"];

document.getElementById("editor2").addEventListener("input", function(event) {
  highlightSyntax(event.target);
});

function highlightSyntax(div) {
  const selection = window.getSelection();
  const range = selection.getRangeAt(0);

  // Save the cursor position
  const cursorPosition = getCursorPosition(div, range);

  const content = div.textContent;

  // Replace content with highlights
  let lightedContent = content
    // Highlight numbers
    .replace(/(\b\d+(\.\d+)?\b)/g, `<span class="highlight-number">$1</span>`)
    // Highlight strings (in quotes)
    .replace(/(['"`])(.*?)(\1)/g, `<span class="highlight-string">$&</span>`)
    // Highlight comments (after //)
    .replace(/(\/\/.*?)(\n|$)/g, `<span class="highlight-comment">$1</span>`)
    // Highlight keywords
    .replace(new RegExp(`\\b(${keywords.join("|")})\\b`, 'g'), `<span class="highlight-keyword">$1</span>`)
    // Highlight functions (identifiers followed by ())
    .replace(/\b(\w+)\(\)/g, `<span class="highlight-function">$&</span>`)
    // Highlight variables (check after var, let, const)
    .replace(/\b(var|let|const)\s+(\w+)\b/g, `$1 <span class="highlight-variable">$2</span>`)
    // Highlight brackets
    .replace(/(\{|\}|\[|\]|\(|\))/g, `<span class="highlight-bracket">$1</span>`);

  // Apply the highlighted content
  div.innerHTML = lightedContent;

  // Restore the cursor position
  restoreCursorPosition(div, cursorPosition);
}

function getCursorPosition(div, range) {
  let position = 0;

  // Count characters up to the range's start
  const stack = [div];
  while (stack.length) {
    const node = stack.shift();

    if (node === range.startContainer) {
      position += range.startOffset;
      break;
    }

    if (node.textContent) position += node.textContent.length;
    stack.push(...node.childNodes);
  }

  return position;
}

function restoreCursorPosition(div, position) {
  let range = document.createRange();
  let selection = window.getSelection();

  let stack = [div];
  let currentPos = 0;

  while (stack.length) {
    const node = stack.shift();

    if (node.nodeType === Node.TEXT_NODE) {
      const nextPos = currentPos + node.textContent.length;

      if (position <= nextPos) {
        range.setStart(node, position - currentPos);
        range.collapse(true);
        break;
      }

      currentPos = nextPos;
    } else {
      stack.push(...node.childNodes);
    }
  }

  selection.removeAllRanges();
  selection.addRange(range);
}

</script>

