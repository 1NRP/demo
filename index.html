<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Textarea Example</title>
<style>
    #textBox {
        width: 300px;
        height: 200px;
    }
</style>
</head>
<body>

<textarea id="textBox"></textarea>

<script>
    // Get the textarea element
    const textBox = document.getElementById('textBox');
    const placeholder = document.getElementById('vid');
    let clickCount = 0;
    let clickTimer;
    let isCopying = false;

    // Set initial mode to "paste"
    document.getElementById('pasteCopyButton').innerText = 'üóí';

    // Function to paste text from placeholder to textbox
    function pasteText() {
        textBox.value += (textBox.value.length > 0 ? '\n\n' : '') + placeholder.value;
    }

    // Function to copy text from textbox to clipboard
    function copyTextBoxToClipboard() {
        textBox.select();
        document.execCommand('copy');
    }

    // Handle button click
    function handleButtonClick() {
        clickCount++;
        clearTimeout(clickTimer);
        clickTimer = setTimeout(() => {
            if (clickCount >= 3) {
                toggleMode();
            } else {
                if (isCopying) {
                    copyTextBoxToClipboard(); 
                } else {
                    pasteText();
                }
            }
            clickCount = 0;
        }, 800);  // 3 clicks in 0.8 seconds or 800 milliseconds.
    }

    // Function to toggle between paste and copy modes
    function toggleMode() {
        isCopying = !isCopying;
        document.getElementById('pasteCopyButton').innerText = isCopying ? '‚úÇÔ∏è' : 'üóí';
        if (!isCopying) {
            makeLinesClickable();
        } else {
            removeLinesClickable();
        }
    }

    // Function to make lines clickable for copying
    function makeLinesClickable() {
        textBox.removeEventListener('click', handleTextBoxClick);
        textBox.addEventListener('click', handleLineClick);
    }

    // Function to remove clickability of lines
    function removeLinesClickable() {
        textBox.removeEventListener('click', handleLineClick);
        textBox.addEventListener('click', handleTextBoxClick);
    }

    // Function to handle click on specific lines
    function handleLineClick(event) {
        const line = event.target.textContent.trim();
        if (line) {
            const selection = window.getSelection();
            selection.removeAllRanges();
            const range = document.createRange();
            range.selectNodeContents(event.target);
            selection.addRange(range);
            document.execCommand('copy');
            selection.removeAllRanges();
        }
    }

    // Function to handle click on the textbox
    function handleTextBoxClick(event) {
        const currentTime = new Date().getTime();
        if (currentTime - lastClickTime < 800) {
            clickCount++;
            if (clickCount >= 3) {
                textBox.readOnly = false;
                textBox.style.backgroundColor = 'white';
            }
        } else {
            clickCount = 1;
        }
        lastClickTime = currentTime;
    }

    // Function to store and retrieve Terabox links using browser Cache method.
    function updateCachedContent() {
        const textBoxContent = textBox.value;
        const cachedItem = {
            content: textBoxContent
        };

        localStorage.setItem('cachedTextBoxContent', JSON.stringify(cachedItem));
    }

    function loadFromCache() {
        const cachedItem = JSON.parse(localStorage.getItem('cachedTextBoxContent'));
        if (cachedItem) {
            textBox.value = cachedItem.content;
        }
    }

    // Load cached content on page load
    loadFromCache();

    // Cache is updated every time the Copy/Paste button is clicked, with a delay of 1 second
    // Cache can be manually cleared using Tamper-monkey or through the browser
    document.getElementById('pasteCopyButton').addEventListener('click', () => {
        setTimeout(updateCachedContent, 1000);  // 1 second delay because link is pasted after 0.8 seconds of clicking the button.
    });

</script>

</body>
</html>
